<%- include('./template/header'); -%>

<div class="row">
    <div class="col-lg-12">
        <div class="row px-2 mb-1">
            <div class="row">
                <div class="card shadow-sm mb-3">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-lg-6">
                                <h5 class="pt-2">ข้อมูลบุคลากร</h5>
                            </div>
                            <div class="col-lg-6 text-end">
                                <div class="btn btn-primary shadow-sm" ><i class="fas fa-plus me-2"></i>เพิ่มข้อมูลบุคลากร</div>
                            </div>
                        </div>
                        <hr class="mb-4">
                        <!-- non req -->
                        <div class="row non-req">
                            <span class="text-center my-5">
                                <span style="font-size:20px; color: rgba(0, 0, 0, 0.4);">
                                    <i class="fas fa-user-tie mb-2" style="margin-top: 20px; font-size:50px;"></i>
                                    <p>ยังไม่ได้ระบุ " บุคลากร "</p>
                                </span>
                            </span>
                        </div>
                        <!-- end non req -->

                        <!-- begin form -->
                        <div class="row form-data">
                            <div class="col-lg-8 py-4 pe-2">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="input-group ps-1 mb-3">
                                            <label class="col-form-label ps-4 ms-3 me-2">รหัส RFID : </label>
                                            <input type="text" class="form-control rounded-3 me-2">
                                            <div class="btn btn-warning shadow-sm rounded-3">เคลียร์ Tag</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="input-group mb-3">
                                            <label class="col-form-label ps-2 ms-3 me-2">รหัสพนักงาน : </label>
                                            <input type="text" class="form-control rounded-3" disabled>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="row">
                                            <div class="col-sm-8">
                                                <div class="input-group mb-3">
                                                    <label class="col-form-label ps-1 ms-3 me-2">ชื่อ - นามสกุล : </label>
                                                    <input type="text" class="form-control rounded-3" disabled>
                                                </div>
                                            </div>
                                            <div class="col-sm-4">
                                                <div class="input-group mb-3">
                                                    <label class="col-form-label ps-1 ms-3 me-2">เพศ : </label>
                                                    <select class="form-select rounded-3" disabled>
                                                        <option value=""> </option>
                                                        <option value="ชาย">ชาย</option>
                                                        <option value="หญิง">หญิง</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="input-group mb-2">
                                            <label class="col-form-label ps-1 ms-3 me-2">เบอร์โทรศัพท์ : </label>
                                            <input type="text" class="form-control rounded-3" disabled>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="px-5">
                                    <div name="member_image" class="dropzone text-center shadow-sm mx-4" style="background-color:#ffff; border-color:#ced4da; border-radius: 1.25rem;">
                                        <div class="dz-default dz-message" style="height: 110px;">
                                            <span>
                                                <span style="font-size:15px;">
                                                    <i class="fas fa-cloud-upload-alt" style="margin-top: 20px; font-size:50px;"></i>
                                                    <p>เพิ่มรูปภาพบุคลากร</p>
                                                </span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <hr class="my-3">
                            <div class="row">
                                <div class="col-lg-12 text-end">
                                    <div class="btn btn-outline-secondary"><i class="fas fa-times me-2"></i>ยกเลิก</div>
                                    <div class="btn btn-success"><i class="fas fa-save me-2"></i>บันทึก</div>
                                </div>
                            </div>
                        </div>
                        <!-- end form -->
                        
                    </div>
                </div>

               

                <div class="card shadow-sm mb-3">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-lg-7">
                                <h5 class="pt-2">ตารางข้อมูลบุคลากร</h5>
                            </div>
                            <div class="col-lg-5">
                                <div class="input-group shadow-sm mb-2">
                                   <input type="text" class="form-control" placeholder="ชื่อ, รหัสพนักงาน, เบอร์โทรศัพท์">
                                    <div class="btn btn-secondary" id=""><i class="fas fa-search me-2"></i>ค้นหา</div>
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped my-2" id="table_id" style="min-height: 428px;">
                                <thead class="table-navy-blue">
                                    <tr>
                                        <th class="text-center">ลำดับ</th>
                                        <th class="text-center">รหัส RFID</th>
                                        <th class="text-center">รหัสพนักงาน</th>
                                        <th class="text-center">ชื่อ</th>
                                        <th class="text-center">เพศ</th>
                                        <th class="text-center">เบอร์โทรศัพท์</th>
                                        <th class="text-center">จัดการข้อมูล</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="text-center">1</td>
                                        <td class="text-center">4312341234</td>
                                        <td class="text-center">00001</td>
                                        <td class="text-center">00001</td>
                                        <td class="text-center">AAAA</td>
                                        <td class="text-center">B</td>
                                        <td class="text-center"><div class="btn btn-danger btn-sm"><i class="fas fa-trash me-2"></i>ลบ</div> <div class="btn btn-warning btn-sm"><i class="fas fa-pen me-2"></i></i>แก้ไข</div></td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">2</td>
                                        <td class="text-center">4312341234</td>
                                        <td class="text-center">00001</td>
                                        <td class="text-center">00001</td>
                                        <td class="text-center">AAAA</td>
                                        <td class="text-center">B</td>
                                        <td class="text-center"><div class="btn btn-danger btn-sm"><i class="fas fa-trash me-2"></i>ลบ</div> <div class="btn btn-warning btn-sm"><i class="fas fa-pen me-2"></i></i>แก้ไข</div></td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">3</td>
                                        <td class="text-center">4312341234</td>
                                        <td class="text-center">00001</td>
                                        <td class="text-center">00001</td>
                                        <td class="text-center">AAAA</td>
                                        <td class="text-center">B</td>
                                        <td class="text-center"><div class="btn btn-danger btn-sm"><i class="fas fa-trash me-2"></i>ลบ</div> <div class="btn btn-warning btn-sm"><i class="fas fa-pen me-2"></i></i>แก้ไข</div></td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">4</td>
                                        <td class="text-center">4312341234</td>
                                        <td class="text-center">00001</td>
                                        <td class="text-center">00001</td>
                                        <td class="text-center">AAAA</td>
                                        <td class="text-center">B</td>
                                        <td class="text-center"><div class="btn btn-danger btn-sm"><i class="fas fa-trash me-2"></i>ลบ</div> <div class="btn btn-warning btn-sm"><i class="fas fa-pen me-2"></i></i>แก้ไข</div></td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">5</td>
                                        <td class="text-center">4312341234</td>
                                        <td class="text-center">00001</td>
                                        <td class="text-center">00001</td>
                                        <td class="text-center">AAAA</td>
                                        <td class="text-center">B</td>
                                        <td class="text-center"><div class="btn btn-danger btn-sm"><i class="fas fa-trash me-2"></i>ลบ</div> <div class="btn btn-warning btn-sm"><i class="fas fa-pen me-2"></i></i>แก้ไข</div></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<%- include('./template/footer'); -%>

<script>
    var Feature = (function(){
        Dropzone.autoDiscover = false;

        var dataTable = $('#table_id').DataTable({
            language: {emptyTable: "ไม่พบข้อมูลบุคลากร"},
            searching: false,
            lengthChange: false,
            ordering:false,
            responsive: true
            // iDisplayLength: 10,
        });
            
        return {
            initDropzone: function () {
                dropzoneAdd = new Dropzone('[name=member_image]', {
                    url: function () {
                        return '';
                        },
                    paramName: "upload",
                    maxFiles: 1,
                    maxFilesize: 25, // Max file size 25 mb
                    addRemoveLinks: true,
                    paralleluploads: 1,
                    acceptedFiles: ".jpg,.png,.gif,.jpeg,.jfif",
                    dictDefaultMessage: "",
                    init: function () {
                        this.on("thumbnail", function (file, fileUrl) {
                            $('.dz-preview').last().find('img').attr({ width: '100%', height: '100%'});
                        }),
                           
                        this.on("complete", function (file) {
                            $(".dz-remove").html('<div class="btn btn-sm btn-danger shadow-sm w-100 mt-2" style="border-radius: 15px;"><i class="fa fa-trash me-2"></i>ลบรูปภาพ</div>');
                            //console.log(file)
                        });
                                
                        this.on("maxfilesexceeded", function(file){
                            var _ref;
                            var _this = $(this.element);
                            _this.find('.dz-message').hide();
                                Swal.fire ({
                                    icon: 'warning',
                                    title: 'ไม่สามารถอับโหลดรูปมากกว่า 1 รูปได้',
                                    text: 'กรุณากดปุ่ม"ยืนยัน"และทำการอัพโหลดรูปภาพใหม่',
                                    confirmButtonText: "ยืนยัน",
                                    
                                }) .then((result) => {
                                    if (result.isConfirmed) {
                                        if (file.previewElement) {
                                            if ((_ref = file.previewElement) != null) {
                                            _ref.parentNode.removeChild(file.previewElement);
                                            _this.find('.dz-message').show();
                                            has_image = 0;
                                            // console.log(has_image);
                                            }
                                        }
                                    } 
                                });
                            });
                        },
                        success: function (file, response) {
                            var jsonResult = JSON.parse(response);
                            console.log(jsonResult)
                            if (jsonResult.result == "1") {
                                file.previewElement.classList.add("dz-success");
                                    var fileUrl = jsonResult["file_url"];
                                    var file_name = jsonResult["file_name"];
                                    file.id = 0;
                                    has_image = 1;
                                    image_url = file_name;
                                    //console.log(image_url);
                                }
                                else {
                                    file.previewElement.classList.add("dz-error");
                                }
                            },                           
                            error: function (file, response) {
                        },
                        removedfile: function (file) {
                            var _ref;
                            var _this = $(this.element);
                                _this.find('.dz-message').hide();
                            Swal.fire ({
                                icon: 'warning',
                                title: 'กรุณายืนยันการลบ',
                                text: 'เมื่อกด "ยืนยัน" ระบบจะทำการลบรูปภาพสินค้า',
                                showCancelButton: true,
                                confirmButtonText: "ยืนยัน",
                                cancelButtonText: "ยกเลิก",
                            }) .then((result) => {
                            if (result.isConfirmed) {
                                if (file.previewElement) {
                                    if ((_ref = file.previewElement) != null) {
                                    _ref.parentNode.removeChild(file.previewElement);
                                    _this.find('.dz-message').show();
                                    has_image = 0;
                                    // console.log(has_image);
                                    }
                                }
                            } else {
                                _this.addClass('dz-started');
                                has_image = 1;
                            }
                        });
                    }
                });        
            },
            initRequest: function () {
                $('.form-data').hide()
                // $('.non-req').hide()
            },
            init: function () {
                Feature.initDropzone();
                Feature.initRequest();
            }
        }
    })();
  
    jQuery(document).ready(function () {
      Feature.init();
      
    });  
</script>