<%- include('./template/header'); -%>

    <div class="row">
        <div class="col-lg-4">

        </div>
        <div class="col-lg-8">
            <div class="col-lg-12">
                <div class="card shadow-sm mb-3">
                    <div class="card-body pb-0">
                        <div class="row">

                            <div class="col-xxl-8 mb-3">

                                <div class="input-group rounded">
                                    <select class="form-select me-3 rounded" aria-label=".form-select-sm example">
                                        <option selected>เลือก...</option>
                                        <option value="1">รายการทั้งหมด</option>
                                        <option value="2">รายการยืม</option>
                                        <option value="3">รายการคืน</option>
                                    </select>
                                    <input type="datetime" id="start_date" class="form-control rounded" placeholder="เริมต้น " aria-label="start-date ">
                                    <span class="input-group-text ">ถึง</span>
                                    <input type="datetime " id="end_date" class="form-control " placeholder="สิ้นสุด " aria-label="enddate ">
                                </div>
                            </div>

                            <div class="col-xxl-4 mb-3 text-end ">
                                <div class="btn btn-outline-secondary " id="clear"><i class="fas fa-times me-2 "></i>ยกเลิก</div>
                                <div class="btn btn-success " id="search"><i class="fas fa-search me-2 "></i>ค้นหา</div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row ">
        <div class="col-lg-12 ">
            <div class="card shadow-sm " style="min-height: 400px; ">
                <div class="card-body ">
                    <table class="table table-striped " id="table_id">
                        <thead class="table-navy-blue ">
                            <tr>
                                <th class="text-center ">วันที่</th>
                                <th class="text-center ">รหัสพนักงาน</th>
                                <th class="text-center ">ชื่อ-นามสกุล</th>
                                <th class="text-center ">รายการ</th>
                                <th class="text-center ">รุ่น</th>
                                <th class="text-center ">เวลา</th>
                                <th class="text-center ">แผนก</th>
                                <!-- <th class="text-center ">แจ้งเตือน</th> -->
                                <th class="text-center ">สถานะ</th>
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <%- include('./template/footer'); -%>

        <script>
            var Feature = (function() {
                var startDate = $('#start_date').datepicker();
                var endDate = $('#end_date').datepicker();
                var dataTable = $('#table_id').DataTable({
                    searching: false,
                    responsive: true,
                    ordering: false,
                    lengthChange: false,
                    iDisplayLength: 10,
                    bAutoWidth: false,
                    columns: [{
                        data: function(data) {
                            return data['borrow_date'];
                        },
                        className: 'text-center',
                    }, {
                        data: function(data) {
                            return data['id'];
                        },
                        className: 'text-center',
                    }, {
                        data: function(data) {
                            return data['firstname'] + '  ' + data['lastname'];
                        },
                        className: 'text-center',
                    }, {
                        data: function(data) {
                            return data['equipment_name'];
                        },
                        className: 'text-center',
                    }, {
                        data: function(data) {
                            return data['equipment_number'];
                        },
                        className: 'text-center',
                    }, {
                        data: function(data) {
                            return data['return_date'];
                        },
                        className: 'text-center',
                    }, {
                        data: function(data) {
                            return data['department_name'];
                        },
                        className: 'text-center',
                    }, {
                        data: function(data) {
                            return data['status'];
                        },
                        className: 'text-center',
                    }],
                    serverSide: true,
                    ajaxSource: '/report/search',
                    serverData: function(sSource, aaData, fnCallback, oSettings) {
                        aaData.push({
                            "name": "typeSearch",
                            "value": ""
                        });
                        aaData.push({
                            "name": "firstDate",
                            "value": ""
                        });
                        aaData.push({
                            "name": "untilDate",
                            "value": ""
                        });
                        oSettings.jqXHR = $.ajax({
                            dataType: 'json',
                            type: "POST",
                            url: sSource,
                            data: aaData,
                            success: function(response) {
                                console.log(response);

                                fnCallback(response);

                            }
                        });
                    },
                    createdRow: function(row, data, index) {}
                });

                return {
                    searchData: function() {
                        $('#search').on('click', function(e) {
                            var startData = $('#start_date').val();
                            var endData = $('#end_date').val();
                            console.log(startData);
                            var sData = Date.parse(startData);
                            var eData = Date.parse(endData);
                            console.log(sData);
                            if (sData < eData) {
                                console.log("true");
                                window.location = '/report?startDate=' + startData + '&endDate=' + endData;

                            } else {
                                console.log("false");
                                Swal.fire({
                                    title: "ไม่สามารถค้นหาได้",
                                    text: "กรุณาใส่วันที่ค้นหาให้ถูกต้อง",
                                    icon: "warning"
                                });
                            }
                            // window.location = '/?startDate=' + startData + '&endDate=' + endData;

                        });
                        $('#clear').on('click', function(e) {
                            $('#start_date').val('');
                            $('#end_date').val('');
                        });
                    },
                    init: function() {
                        Feature.searchData();
                    }
                }
            })();

            jQuery(document).ready(function() {
                Feature.init();
            });
        </script>